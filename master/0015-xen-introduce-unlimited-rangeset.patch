From 62c6a69f4b9e5952860e48db783109b6481a3da5 Mon Sep 17 00:00:00 2001
From: Zhi Wang <zhi.a.wang@intel.com>
Date: Tue, 10 Feb 2015 23:24:09 +0800
Subject: [PATCH 15/18] xen: introduce unlimited rangeset.

Signed-off-by: Zhi Wang <zhi.a.wang@intel.com>
---
 xen/common/rangeset.c      | 2 +-
 xen/include/xen/rangeset.h | 2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/xen/common/rangeset.c b/xen/common/rangeset.c
index 116d5dc..cedc211 100644
--- a/xen/common/rangeset.c
+++ b/xen/common/rangeset.c
@@ -98,7 +98,7 @@ static struct range *alloc_range(
 {
     struct range *x;
 
-    if ( r->nr_ranges == 0 )
+    if ( !(r->flags & RANGESETF_unlimited) && r->nr_ranges == 0 )
         return NULL;
 
     x = xmalloc(struct range);
diff --git a/xen/include/xen/rangeset.h b/xen/include/xen/rangeset.h
index 5ed6817..197cee3 100644
--- a/xen/include/xen/rangeset.h
+++ b/xen/include/xen/rangeset.h
@@ -49,6 +49,8 @@ void rangeset_limit(
  /* Pretty-print range limits in hexadecimal. */
 #define _RANGESETF_prettyprint_hex 0
 #define RANGESETF_prettyprint_hex  (1U << _RANGESETF_prettyprint_hex)
+#define _RANGESETF_unlimited 1
+#define RANGESETF_unlimited (1U << _RANGESETF_unlimited)
 
 int __must_check rangeset_is_empty(
     struct rangeset *r);
-- 
1.8.3.1

